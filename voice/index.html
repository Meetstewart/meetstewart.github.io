<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talk to Stewart - Voice Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 300;
            letter-spacing: 0.3em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4a9eff, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .tagline {
            color: #888;
            margin-bottom: 40px;
            font-size: 0.95rem;
        }

        .timer-container {
            background: rgba(74, 158, 255, 0.1);
            border: 1px solid rgba(74, 158, 255, 0.3);
            border-radius: 12px;
            padding: 15px 25px;
            margin-bottom: 30px;
            display: none;
        }

        .timer-container.active { display: block; }

        .timer-label {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
        }

        .timer {
            font-size: 2rem;
            font-weight: 600;
            font-family: 'SF Mono', Monaco, monospace;
            color: #4a9eff;
        }

        .timer.warning { color: #f59e0b; }
        .timer.critical { color: #ef4444; animation: pulse 1s ease-in-out infinite; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .voice-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(135deg, #1a1a2e 0%, #2a2a4e 100%);
            border: 3px solid #4a9eff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .voice-circle:hover {
            transform: scale(1.05);
            box-shadow: 0 0 40px rgba(74, 158, 255, 0.3);
        }

        .voice-circle.listening {
            border-color: #10b981;
            animation: listening-pulse 1.5s ease-in-out infinite;
        }

        .voice-circle.speaking {
            border-color: #8b5cf6;
            animation: speaking-pulse 0.5s ease-in-out infinite;
        }

        .voice-circle.processing {
            border-color: #f59e0b;
        }

        @keyframes listening-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 0 50px rgba(16, 185, 129, 0.5); }
        }

        @keyframes speaking-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); }
            50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.6); }
        }

        .mic-icon {
            font-size: 4rem;
            color: #4a9eff;
            transition: color 0.3s;
        }

        .voice-circle.listening .mic-icon { color: #10b981; }
        .voice-circle.speaking .mic-icon { color: #8b5cf6; }
        .voice-circle.processing .mic-icon { color: #f59e0b; }

        .status {
            font-size: 1.1rem;
            margin-bottom: 20px;
            min-height: 30px;
            color: #ccc;
        }

        .transcript-box {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            min-height: 80px;
            text-align: left;
        }

        .transcript-label {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .transcript-text {
            color: #fff;
            font-size: 1rem;
            line-height: 1.5;
        }

        .response-text {
            color: #4a9eff;
        }

        .voice-selector {
            margin-bottom: 30px;
        }

        .voice-selector label {
            display: block;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 8px;
        }

        .voice-selector select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px 15px;
            color: #fff;
            font-size: 0.95rem;
            width: 100%;
            cursor: pointer;
        }

        .voice-selector select option {
            background: #1a1a2e;
            color: #fff;
        }

        .cta-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .cta-text {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .cta-button {
            background: linear-gradient(135deg, #4a9eff 0%, #8b5cf6 100%);
            color: #fff;
            border: none;
            padding: 14px 35px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(74, 158, 255, 0.3);
        }

        .instructions {
            color: #666;
            font-size: 0.85rem;
            margin-top: 20px;
        }

        /* Mobile */
        @media (max-width: 600px) {
            .logo { font-size: 2rem; }
            .voice-circle { width: 150px; height: 150px; }
            .mic-icon { font-size: 3rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">STEWART</div>
        <div class="tagline">Your AI Business Partner</div>

        <div class="timer-container" id="timerContainer">
            <div class="timer-label">Demo Time Remaining</div>
            <div class="timer" id="timer">10:00</div>
        </div>

        <div class="voice-selector">
            <label>Stewart's Voice</label>
            <select id="voiceSelect">
                <option value="cjVigY5qzO86Huf0OWal">Eric - Professional & Trustworthy</option>
                <option value="JBFqnCBsd6RMkjVDRZzb">George - Warm British Storyteller</option>
                <option value="EXAVITQu4vr4xnSDxMaL">Bella - Bright & Professional</option>
                <option value="onwK4e9ZLuTAKqWW03F9">Daniel - British Broadcaster</option>
                <option value="pFZP5JQG7iQjIQuC4Bku">Lily - Velvety British Actress</option>
                <option value="TX3LPaxmHKxFdv7VOQHJ">Liam - Energetic Creator</option>
                <option value="XB0fDUnXU5powFXDhCwa">Charlotte - Seductive & Mysterious</option>
                <option value="pqHfZKP75CvOlQylNhV4">Bill - Wise & Mature</option>
                <option value="nPczCjzI2devNBz1zQrb">Brian - Deep & Comforting</option>
                <option value="N2lVS1w4EtoT3dr4eOWO">Callum - Husky Trickster</option>
                <option value="IKne3meq5aSn9XLyUdCD">Charlie - Deep Australian</option>
                <option value="XrExE9yKIg1WjnnlVkGX">Matilda - Professional Narrator</option>
            </select>
        </div>

        <div class="voice-circle" id="voiceCircle" onclick="toggleListening()">
            <span class="mic-icon" id="micIcon">üé§</span>
        </div>

        <div class="status" id="status">Click to start talking to Stewart</div>

        <div class="transcript-box">
            <div class="transcript-label">Conversation</div>
            <div class="transcript-text" id="transcript">Say hello to begin...</div>
        </div>

        <div class="cta-section">
            <div class="cta-text">Like what you see? Get 14 days free.</div>
            <button class="cta-button" onclick="window.location.href='https://meetstewart.github.io/#signup'">Start Free Trial</button>
        </div>

        <div class="instructions">
            Press the microphone and speak naturally.<br>
            Stewart will respond with voice.
        </div>
    </div>

    <script>
        // ElevenLabs API (direct browser call)
        const ELEVENLABS_KEY = 'sk_933372d07bc70b591aad7041bf5a6e37d4f20c5d92e04c68';
        
        // State
        let isListening = false;
        let recognition = null;
        let timerInterval = null;
        let secondsRemaining = 600; // 10 minutes
        let trialStarted = false;
        let audioContext = null;

        // Elements
        const voiceCircle = document.getElementById('voiceCircle');
        const micIcon = document.getElementById('micIcon');
        const status = document.getElementById('status');
        const transcript = document.getElementById('transcript');
        const timerContainer = document.getElementById('timerContainer');
        const timerDisplay = document.getElementById('timer');
        const voiceSelect = document.getElementById('voiceSelect');

        // Initialize speech recognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                voiceCircle.className = 'voice-circle listening';
                micIcon.textContent = 'üéôÔ∏è';
                status.textContent = 'Listening...';
            };

            recognition.onresult = (event) => {
                let finalTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const t = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript = t;
                    }
                }
                if (finalTranscript) {
                    handleUserInput(finalTranscript);
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                resetState();
                if (event.error === 'not-allowed') {
                    status.textContent = 'Microphone access denied. Please enable it in browser settings.';
                } else {
                    status.textContent = 'Error: ' + event.error + '. Click to try again.';
                }
            };

            recognition.onend = () => {
                if (isListening) {
                    isListening = false;
                }
            };
        } else {
            status.textContent = 'Voice not supported in this browser. Try Chrome or Safari.';
            voiceCircle.style.opacity = '0.5';
            voiceCircle.style.cursor = 'not-allowed';
        }

        function toggleListening() {
            if (!recognition) return;

            if (!trialStarted) {
                startTrial();
            }

            if (isListening) {
                recognition.stop();
                resetState();
            } else {
                isListening = true;
                recognition.start();
            }
        }

        function resetState() {
            isListening = false;
            voiceCircle.className = 'voice-circle';
            micIcon.textContent = 'üé§';
            status.textContent = 'Click to talk to Stewart';
        }

        function startTrial() {
            trialStarted = true;
            timerContainer.classList.add('active');
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            secondsRemaining--;
            if (secondsRemaining <= 0) {
                clearInterval(timerInterval);
                endTrial();
                return;
            }

            const minutes = Math.floor(secondsRemaining / 60);
            const seconds = secondsRemaining % 60;
            timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

            // Warning colors
            if (secondsRemaining <= 60) {
                timerDisplay.className = 'timer critical';
            } else if (secondsRemaining <= 180) {
                timerDisplay.className = 'timer warning';
            }
        }

        function endTrial() {
            status.textContent = 'Demo time ended. Sign up for full access!';
            voiceCircle.style.opacity = '0.5';
            voiceCircle.onclick = null;
            transcript.innerHTML = '<span class="response-text">Thanks for trying Stewart! Ready to see what we can do for your business? Start your 14-day free trial.</span>';
        }

        async function handleUserInput(text) {
            voiceCircle.className = 'voice-circle processing';
            micIcon.textContent = '‚è≥';
            status.textContent = 'Thinking...';

            transcript.innerHTML = `<strong>You:</strong> ${text}`;

            // Generate response
            const response = generateResponse(text);
            
            transcript.innerHTML += `<br><br><span class="response-text"><strong>Stewart:</strong> ${response}</span>`;

            // Speak response with ElevenLabs
            await speakWithElevenLabs(response);

            resetState();
        }

        function generateResponse(input) {
            const lower = input.toLowerCase();

            // Greetings
            if (lower.match(/\b(hi|hello|hey|good morning|good afternoon)\b/)) {
                return "Hello! I'm Stewart, your AI business partner. I handle the work so you can focus on what matters. What can I help you with today?";
            }

            // What can you do
            if (lower.match(/\b(what can you do|what do you do|how do you work|capabilities|features)\b/)) {
                return "I'm like having a full team working 24/7. I manage emails, coordinate projects, analyze data, and handle communications. Think of me as your executive assistant, analyst, and project manager rolled into one. What area of your business needs the most help?";
            }

            // Pricing
            if (lower.match(/\b(price|cost|how much|pricing|subscription)\b/)) {
                return "I start at $500 a month, which is like getting a $60,000 a year executive assistant. The Dream Team package gives you me plus five specialists for $2,000 a month. That's six virtual staff members for the price of one junior hire. Would you like to hear more about what each specialist does?";
            }

            // Team/specialists
            if (lower.match(/\b(team|specialist|voice|builder|creator|analyst|support)\b/)) {
                return "My team includes Voice for brand communications, Builder for technical work, Creator for design and content, Analyst for data and efficiency, and Support for coordination. Each one does the work of two humans. Together, we're like having twelve people on your team.";
            }

            // Trial
            if (lower.match(/\b(trial|try|free|test)\b/)) {
                return "You're already experiencing the trial! You've got this 10-minute voice demo, and when you're ready, we offer a 14-day full trial. No commitment, cancel anytime. Your data stays yours. Want me to tell you more about what you'd get in the full trial?";
            }

            // Business/company
            if (lower.match(/\b(business|company|startup|entrepreneur)\b/)) {
                return "I work with businesses of all sizes. From solo entrepreneurs who need their time back, to growing companies that can't hire fast enough. What kind of business are you running?";
            }

            // Data/privacy
            if (lower.match(/\b(data|privacy|secure|security|safe)\b/)) {
                return "Great question. We keep zero client data on our servers. Everything stays in your Dropbox or Google Drive. We never see your credentials. It's zero trust by design. Your data is always in your hands.";
            }

            // Default conversational
            return "That's a great point. Tell me more about your situation and I can explain how I'd help. What's taking up most of your time right now?";
        }

        async function speakWithElevenLabs(text) {
            voiceCircle.className = 'voice-circle speaking';
            micIcon.textContent = 'üîä';
            status.textContent = 'Speaking...';

            const voiceId = voiceSelect.value;

            try {
                const response = await fetch(`https://api.elevenlabs.io/v1/text-to-speech/${voiceId}/stream`, {
                    method: 'POST',
                    headers: {
                        'xi-api-key': ELEVENLABS_KEY,
                        'Content-Type': 'application/json',
                        'Accept': 'audio/mpeg'
                    },
                    body: JSON.stringify({
                        text: text,
                        model_id: 'eleven_turbo_v2_5',
                        voice_settings: {
                            stability: 0.5,
                            similarity_boost: 0.75,
                            style: 0.0
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error('ElevenLabs API error: ' + response.status);
                }

                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioUrl);

                return new Promise((resolve) => {
                    audio.onended = () => {
                        URL.revokeObjectURL(audioUrl);
                        resolve();
                    };
                    audio.onerror = () => {
                        console.error('Audio playback error');
                        resolve();
                    };
                    audio.play().catch(e => {
                        console.error('Playback failed:', e);
                        resolve();
                    });
                });
            } catch (error) {
                console.error('TTS Error:', error);
                status.textContent = 'Voice unavailable - response shown above';
                return Promise.resolve();
            }
        }
    </script>
</body>
</html>
